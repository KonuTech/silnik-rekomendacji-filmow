 select genresSimilarity.genresSimilarity, actorsSimilarity.actorsSimilarity, languagesSimilarity.languagesSimilarity, countriesSimilarity.countriesSimilarity from

 (select sum(minimum)/sum(maksimum) as genresSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 left join (select nazwa_gatunek, fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_gatunek = g1.id_gatunek UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 right join (select nazwa_gatunek, fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_gatunek = g1.id_gatunek) as maks_min) 
 	as genresSimilarity
 join (select sum(minimum)/sum(maksimum) as actorsSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 left join (select nazwa_aktor, fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_aktor = g1.id_aktor UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 right join (select nazwa_aktor, fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_aktor = g1.id_aktor) as maks_min) 
 	as actorsSimilarity
 join (select sum(minimum)/sum(maksimum) as languagesSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 left join (select nazwa_jezyk, fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_jezyk = g1.id_jezyk UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 right join (select nazwa_jezyk, fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_jezyk = g1.id_jezyk) as maks_min) 
 	as languagesSimilarity
 join (select sum(minimum)/sum(maksimum) as countriesSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 left join (select nazwa_panstwo, fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_panstwo = g1.id_panstwo UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 right join (select nazwa_panstwo, fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_panstwo = g1.id_panstwo) as maks_min) 
 	as countriesSimilarity;


 -- Ważona suma podobieństw

  select round(((genresSimilarity.genresSimilarity*6/10)+(actorsSimilarity.actorsSimilarity*2/10)+(languagesSimilarity.languagesSimilarity*1/10)+(countriesSimilarity.countriesSimilarity*1/10)),7) as Similarity from

 (select sum(minimum)/sum(maksimum) as genresSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 left join (select nazwa_gatunek, fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_gatunek = g1.id_gatunek UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 right join (select nazwa_gatunek, fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_gatunek = g1.id_gatunek) as maks_min) 
 	as genresSimilarity
 join (select sum(minimum)/sum(maksimum) as actorsSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 left join (select nazwa_aktor, fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_aktor = g1.id_aktor UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 right join (select nazwa_aktor, fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_aktor = g1.id_aktor) as maks_min) 
 	as actorsSimilarity
 join (select sum(minimum)/sum(maksimum) as languagesSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 left join (select nazwa_jezyk, fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_jezyk = g1.id_jezyk UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 right join (select nazwa_jezyk, fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_jezyk = g1.id_jezyk) as maks_min) 
 	as languagesSimilarity
 join (select sum(minimum)/sum(maksimum) as countriesSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 left join (select nazwa_panstwo, fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_panstwo = g1.id_panstwo UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 6096) as g1 right join (select nazwa_panstwo, fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = 1126) as g2 on g2.id_panstwo = g1.id_panstwo) as maks_min) 
 	as countriesSimilarity;


 -- FUNKCJA FUZZY SIMILARITY
 DROP FUNCTION `FuzzySimilarity`;
CREATE DEFINER=`glebels_root`@`localhost` FUNCTION `FuzzySimilarity`(`id1` INT, `id2` INT) RETURNS DECIMAL(12,7) NOT DETERMINISTIC NO SQL SQL SECURITY DEFINER return (  select round(((genresSimilarity.genresSimilarity*6/10)+(actorsSimilarity.actorsSimilarity*2/10)+(languagesSimilarity.languagesSimilarity*1/10)+(countriesSimilarity.countriesSimilarity*1/10)),7) as Similarity from

 (select sum(minimum)/sum(maksimum) as genresSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id2) as g1 left join (select nazwa_gatunek, fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id1) as g2 on g2.id_gatunek = g1.id_gatunek UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id2) as g1 right join (select nazwa_gatunek, fk.id_gatunek, DoM from Gatunki as g inner join FK_Gatunki_Filmy as fk on fk.id_gatunek = g.id_gatunek inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id1) as g2 on g2.id_gatunek = g1.id_gatunek) as maks_min) 
 	as genresSimilarity
 join (select sum(minimum)/sum(maksimum) as actorsSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id2) as g1 left join (select nazwa_aktor, fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id1) as g2 on g2.id_aktor = g1.id_aktor UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id2) as g1 right join (select nazwa_aktor, fk.id_aktor, DoM from Aktorzy as g inner join FK_Aktorzy_Filmy as fk on fk.id_aktor = g.id_aktor inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id1) as g2 on g2.id_aktor = g1.id_aktor) as maks_min) 
 	as actorsSimilarity
 join (select sum(minimum)/sum(maksimum) as languagesSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id2) as g1 left join (select nazwa_jezyk, fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id1) as g2 on g2.id_jezyk = g1.id_jezyk UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id2) as g1 right join (select nazwa_jezyk, fk.id_jezyk, DoM from Jezyki as g inner join FK_Jezyki_Filmy as fk on fk.id_jezyk = g.id_jezyk inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id1) as g2 on g2.id_jezyk = g1.id_jezyk) as maks_min) 
 	as languagesSimilarity
 join (select sum(minimum)/sum(maksimum) as countriesSimilarity from (select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id2) as g1 left join (select nazwa_panstwo, fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id1) as g2 on g2.id_panstwo = g1.id_panstwo UNION select CASE WHEN g1.DoM is NULL THEN least(0, g2.DoM) WHEN g2.DoM is NULL THEN least(g1.DoM, 0) ELSE LEAST(g1.DoM, g2.DoM) END as minimum, CASE WHEN g1.DoM is NULL THEN greatest(0, g2.DoM) WHEN g2.DoM is NULL THEN greatest(g1.DoM, 0) ELSE greatest(g1.DoM, g2.DoM) END as maksimum from (select fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id2) as g1 right join (select nazwa_panstwo, fk.id_panstwo, DoM from Panstwa as g inner join FK_Panstwa_Filmy as fk on fk.id_panstwo = g.id_panstwo inner join Filmy as f on f.id_film = fk.id_film where f.id_film = id1) as g2 on g2.id_panstwo = g1.id_panstwo) as maks_min) 
 	as countriesSimilarity)